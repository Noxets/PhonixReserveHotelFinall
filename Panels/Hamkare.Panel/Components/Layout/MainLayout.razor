@using MudBlazor.Utilities
@using Hamkare.Component.Header
@inject IHttpContextAccessor HttpContextAccessor
@inherits LayoutComponentBase


<HeadContent>
    <HamkareHeader/>
    <HamkareFooter/>
</HeadContent>

<MudRTLProvider RightToLeft="@(Thread.CurrentThread.CurrentUICulture.IsRtl())" Class="vh-100">

    <MudThemeProvider Theme="_userPanelTheme" @bind-IsDarkMode="@_isDarkMode"/>
    <MudDialogProvider/>
    <MudSnackbarProvider/>

    <MudLayout Class="position-relative overflow-hidden">

        <MudContainer MaxWidth="MaxWidth.False" Class="mb-4 mt-2 p-0 h-100 position-absolute top-50 start-50 translate-middle">
            
            <ErrorBoundary @ref="_errorBoundary">
                @Body
            </ErrorBoundary>
        </MudContainer>

    </MudLayout>

</MudRTLProvider>


@code {
    [Parameter] public RenderFragment ChildContent { get; set; }
    private bool _isDarkMode;

    private ErrorBoundary _errorBoundary;

    protected override void OnParametersSet()
    {
        _errorBoundary?.Recover();
    }

    protected override Task OnInitializedAsync()
    {
        try
        {
            _isDarkMode = HttpContextAccessor.HttpContext?.Request.Cookies["DarkMode"] == "dark";
        }
        catch (Exception e)
        {
            Console.Write(e.Message);
            Console.Write(e.StackTrace);
        }

        return Task.CompletedTask;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
            }
            catch (Exception)
            {
            }
        }

        await base.OnAfterRenderAsync(firstRender);
    }

    readonly MudTheme _userPanelTheme = new()
    {
        PaletteLight = new PaletteLight
        {
            Background = new MudColor("#f9fafc"),
            AppbarBackground = new MudColor("#f9fafc")
        },
        PaletteDark = new PaletteDark
        {
            Background = new MudColor("#14222b"),
            AppbarBackground = new MudColor("#14222b"),
            Surface = new MudColor("#202c33")
        },
        Typography = new Typography
        {
            Default = new Default
            {
                FontFamily =
                [
                    "panel-fa-Font", "OpenSans", "Arial", "sans-serif"
                ]
            }
        }
    };

}